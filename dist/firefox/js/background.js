(()=>{"use strict";var e="MISSING_ENV_VAR".BACKGROUND_SEARCH_TEXT,o="MISSING_ENV_VAR".BACKGROUND_SEARCH_URL,t="MISSING_ENV_VAR".GLOBAL_DEBUG,r=!0;void 0!==t&&(r="true"===t.toLowerCase());var s={};chrome.runtime.onInstalled.addListener((function(){chrome.contextMenus.create({title:e,contexts:["image"],id:"contextImage"})})),chrome.tabs.onUpdated.addListener((function(e,o,t){"complete"===o.status&&t.active&&(s[e]?s[e].observerState=!0:s[e]={observerState:!0,urls:{images:[],audio:[],video:[],text:[],code:[],other:[],domains:[]}})})),chrome.contextMenus.onClicked.addListener((function(e,t){if(t&&"contextImage"===e.menuItemId&&"image"===e.mediaType){var r=encodeURIComponent(e.srcUrl),s="".concat(o,"?url=").concat(r);chrome.tabs.create({url:s})}})),void 0!==chrome.action?chrome.action:void 0!==chrome.browserAction&&chrome.browserAction,chrome.runtime.onMessage.addListener((function(e,o,t){var a,n,c;if(r&&console.log("background.tsx: onMessage: request.message: "+e),"check_background_active"===e.message)return r&&console.log("background_active"),t({message:"background_active"}),!0;var d=(null===(a=o.tab)||void 0===a?void 0:a.id)||e.tabId;return d?(s[d]||(s[d]={observerState:!0,urls:{images:[],audio:[],video:[],text:[],code:[],other:[],domains:[]}}),"page_links"===e.message&&e.urls?(s[d].urls=e.urls,t({status:"received"}),!0):"get_links"===e.message?(t({urls:s[d].urls}),!0):("observer_disconnect"===e.message?(r&&console.log("observer_disconnect "+d),s[d].observerState=!1,t({status:"observer_disconnected"})):"get_observer_state"===e.message&&(void 0!==e.tabId?(r&&console.log("get observer state"+e.tabId+" "+(null===(n=s[e.tabId])||void 0===n?void 0:n.observerState)),t({observerState:null===(c=s[e.tabId])||void 0===c?void 0:c.observerState})):console.error("Error: tabId is undefined")),r&&console.log(e),t({message:"Unrecognized or unprocessable message"}),!0)):(d=e.tabId,r&&console.log("Error: tabId is undefined"+e.message),!0)})),chrome.tabs.onRemoved.addListener((function(e){delete s[e]}))})();