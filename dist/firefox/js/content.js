(()=>{"use strict";var e,r="MISSING_ENV_VAR".CONTENT_MUTATION_TIMEOUT,a="MISSING_ENV_VAR".GLOBAL_DEBUG,t=!0;if(void 0!==a&&(t="true"===a.toLowerCase()),!r)throw new Error("CONTENT_MUTATION_TIMEOUT is not defined in environment variables");if(e=Number(r),isNaN(e))throw new Error("CONTENT_MUTATION_TIMEOUT should be a number");new Map;var s={images:[],audio:[],video:[],text:[],code:[],other:[],domains:[]},o=null;function n(e){(e=e.split("?")[0]).match(/\.(jpeg|jpg|gif|png|svg|webp|bmp|ico|tif|tiff|eps|ai|indd|heif|raw|psd|cr2|nef|orf|sr2)$/i)&&(null==o?void 0:o.images)?s.images.push(e):e.match(/\.(mp3|flac|wav|aac|ogg|oga|m4a|aac|aiff|amr|m4a|opus|wma|alac|dss|dvf|m4p|mmf|mpc|msv|ra|rm|tta|vox|weba)$/i)&&(null==o?void 0:o.audio)?s.audio.push(e):e.match(/\.(mp4|webm|ogg|avi|mov|wmv|flv|mkv|3gp|3g2|h264|m4v|mpg|mpeg|rm|swf|vob|mts|m2ts|ts|qt|yuv|rmvb|asf|amv|mpg2)$/i)&&(null==o?void 0:o.video)?s.video.push(e):e.match(/\.(txt|pdf|doc|docx|odt|rtf|tex|wks|wpd|wps|html|htm|md|odf|xls|xlsx|ppt|pptx|csv|xml|ods|xlr|pages|log|key|odp)$/i)&&(null==o?void 0:o.text)?s.text.push(e):e.match(/\.(py|js|java|c|cpp|cs|h|css|php|swift|go|rb|pl|sh|sql|xml|json|ts|jsx|vue|r|kt|dart|rs|lua|asm|bash|erl|hs|vbs|bat|f|lisp|scala|groovy|ps1)$/i)&&(null==o?void 0:o.code)?s.code.push(e):s.other.push(e);var r=function(e){return(e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]).split(":")[0]}(e);r&&!s.domains.includes(r)&&s.domains.push(r),chrome.runtime.sendMessage({message:"page_links",urls:s})}chrome.storage.sync.get({images:!0,audio:!0,video:!0,text:!0,code:!0},(function(e){o=e})),chrome.runtime.onMessage.addListener((function(r,a,o){var i;t&&console.log("Received message for tabId:",r.tabId);var m=(null===(i=a.tab)||void 0===i?void 0:i.id)||r.tabId;if("start_scraping"===r.message){s={images:[],audio:[],video:[],text:[],code:[],other:[],domains:[]};var d=new MutationObserver((function(a){for(var s=0,o=a;s<o.length;s++){var i=o[s];if("childList"===i.type)for(var c=0,v=Array.from(i.addedNodes);c<v.length;c++){var l=v[c];if(l.nodeType===Node.ELEMENT_NODE){for(var g=l,f=0,u=["img","video","audio","a","link","script","source"];f<u.length;f++)for(var h=u[f],p=g.getElementsByTagName(h),b=0,T=Array.from(p);b<T.length;b++){var N=T[b];(N.src||N.href||N.data)&&n(N.src||N.href||N.data)}(g.src||g.href||g.data)&&n(g.src||g.href||g.data)}}}setTimeout((function(){d.disconnect(),chrome.runtime.sendMessage({message:"observer_disconnect",tabId:m}),t&&console.log("Observer disconnected for tabId:",r.tabId)}),e)}));d.observe(document,{attributes:!1,childList:!0,subtree:!0}),t&&console.log("Mutation observer started for tabId:",r.tabId);var c=0,v=setInterval((function(){var e=Object.values(s).reduce((function(e,r){return e+r.length}),0);e===c&&(d.disconnect(),chrome.runtime.sendMessage({message:"observer_disconnect",tabId:m}),t&&console.log("Observer disconnected for tabId:",r.tabId),clearInterval(v)),c=e}),e);!function(){for(var e=Array.from(document.getElementsByTagName("img")),r=Array.from(document.getElementsByTagName("video")),a=Array.from(document.getElementsByTagName("audio")),t=Array.from(document.getElementsByTagName("a")),s=Array.from(document.getElementsByTagName("link")),o=Array.from(document.getElementsByTagName("script")),i=0,m=e;i<m.length;i++){var d=m[i];d.src&&n(d.src)}for(var c=0,v=r;c<v.length;c++){var l=v[c];l.src&&n(l.src);for(var g=0,f=Array.from(l.getElementsByTagName("source"));g<f.length;g++)(N=f[g]).src&&n(N.src)}for(var u=0,h=a;u<h.length;u++){var p=h[u];p.src&&n(p.src);for(var b=0,T=Array.from(p.getElementsByTagName("source"));b<T.length;b++){var N;(N=T[b]).src&&n(N.src)}}for(var y=0,I=t;y<I.length;y++){var E=I[y];E.href&&n(E.href)}for(var w=0,x=s;w<x.length;w++){var A=x[w];A.href&&n(A.href)}for(var M=0,O=o;M<O.length;M++){var _=O[M];_.src&&n(_.src)}}(),o({success:!0,tabId:r.tabId})}}))})();